\section{The Hilbert transform}

Recall from the introduction that the Hilbert transform of a scalar-valued function $\map{f}{\R}{\C}$ is defined by
\begin{equation*}
  Hf(x) := \frac{1}{\pi} \mathrm{p. v.} \int_{\R} f(x-y) \, \frac{\dd y}{y} := \frac{1}{\pi} \lim_{\substack{\varepsilon \downarrow 0 \\ E \uparrow \infty}} \int_{\varepsilon < |y| < E} f(x-y) \, \frac{\dd y}{y}
\end{equation*}
(the truncation of the integral can be done in different ways; this is not too important).
This operator arises in complex analysis as follows.
Given a real-valued function $\map{f}{\R}{\R}$, there is a unique holomorphic function $F$ on the upper half-space $\C_{+} = \{z \in \C : \Im(z) > 0\}$ such that for almost all $x \in \R = \partial \C_{+}$, the real part $\Re(F)$ satisfies
\begin{equation*}
  \lim_{z \to x} \Re(F(z)) = f(x) \qquad \ae \,  x \in \R,
\end{equation*}
provided the limit is taken within an appropriate region.
It turns out that
\begin{equation*}
  \lim_{z \to x} \Im(F(z)) = Hf(x)
\end{equation*}
for almost all $x \in \R$.
Thus the Hilbert transform computes what is called the \emph{conjugate function} of a real-valued $\map{f}{\R}{\R}$.
See \cite[\textsection 5.1.2]{grafakos} for more details.
There are plenty of other applications of this operator (and its generalisations, notably the Riesz transforms) outside of complex analysis, but we will not be too concerned with these.

Classical methods in harmonic analysis (most notably Calder\'on--Zygmund theory) imply that the Hilbert transform is bounded on $L^p(\R)$ for all $p \in (1,\infty)$, while explicit computation of $Hf$ when $f = \1_{[0,1]}$ shows that $H$ is not bounded on $L^1(\R)$ or $L^\infty(\R)$.
In this chapter (and the next) we will consider Banach-valued extensions of the Hilbert transform.
In particular, we will show that these extensions are bounded on $L^p(\R;X)$ for $p \in (1,\infty)$ if and only if the Banach space $X$ has the UMD property.

Consider a complex Banach space $X$ and fix $p \in (1,\infty)$.
Recall from Chapter \ref{sec:Bochner-spaces} that the tensor extension $H \otimes I$ is defined on the algebraic tensor product $L^p(\R) \otimes X$ by its action on elementary tensors,
\begin{equation*}
  (H \otimes I)(f \otimes \mb{x}) := (Hf) \otimes \mb{x} \qquad \forall f \in L^p(\R), \mb{x} \in X.
\end{equation*}
The algebraic tensor product $L^p(\R) \otimes X$ is the linear span of such elementary tensors, so $H \otimes I$ is extended by linearity to all of $L^p(\R) \otimes X$.
Recall also that $H \in \Lin(L^p(\R))$ admits a bounded $X$-valued extension if and only if
\begin{equation*}
  \|(H \otimes I)\mb{f}\|_{L^p(\R;X)} \lesssim \|\mb{f}\|_{L^p(\R;X)} \qquad \forall \mb{f} \in L^p(\R) \otimes X.
\end{equation*}

In this chapter we will prove the following theorem.

\begin{thm}[Burkholder]\label{thm:Burkholder}
  Suppose that $X$ is a complex UMD Banach space.
  Then for all $p \in (1,\infty)$, the Hilbert transform $H \in \Lin(L^p(\R))$ admits a bounded $X$-valued extension.
\end{thm}

To prove this result, it suffices to prove that for all $0 < \varepsilon < E < \infty$, the \emph{truncated $X$-valued Hilbert transform}
\begin{equation*}
  H_{\varepsilon,E}^{X} \mb{f}(x) :=  \frac{1}{\pi} \int_{\varepsilon < |y| < E} \mb{f}(x-y) \, \frac{\dd y}{y} = \frac{1}{\pi} \int_{\varepsilon < |x-y| < E} \mb{f}(y) \, \frac{\dd y}{x-y}
\end{equation*}
is bounded on $L^p(\R;X)$ \emph{uniformly in $\varepsilon$ and $E$}.
Since the kernel $\1_{(\varepsilon,E)}(y)/y$ is integrable, Young's inequality implies that $H_{\varepsilon,E}$ is bounded on $L^p(\R;X)$, but it does not provide uniformity in the truncation parameters.
Once we have established uniform boundedness of these operators on $L^p(\R;X)$, Theorem \ref{thm:Burkholder} follows by noting that for all $\mb{f} \in L^p(\R) \otimes X$
\begin{equation*}
  \begin{aligned}
    \|(H \otimes I)\mb{f}\|_{L^p(\R;X)}
    = \lim_{\varepsilon \downarrow 0, E \uparrow \infty} \|(H_{\varepsilon,E} \otimes I)\mb{f}\|_{L^p(\R;X)}
    &= \lim_{\varepsilon \downarrow 0, E \uparrow \infty} \|H_{\varepsilon,E}^{X}\mb{f}\|_{L^p(\R;X)} \\
    &\lesssim_{p,X} \|\mb{f}\|_{L^p(\R;X)}
  \end{aligned}
\end{equation*}
(the limit is justified by the definition of the scalar-valued Hilbert transform $Hf(x) = \lim H_{\varepsilon, E}f(x)$ and the fact that $\mb{f} \in L^p(\R) \otimes X$ has finite-dimensional range).

The Hilbert transform commutes with translations and dilations, and anticommutes with reflections.
That is, defining
\begin{equation*}
  \Tr_{s} f (x) := f(x - s), \qquad \Dil_{\lambda} f(x) := \lambda^{-1/2}f(x/\lambda), \qquad   \Refl f(x) := f(-x),
\end{equation*}
we have the identities
\begin{equation*}
  H(\Tr_{s} f) = \Tr_{s} (Hf), \qquad H(\Dil_{\lambda} f) = \Dil_{\lambda} H(f), \quad H(\Refl(f)) = -\Refl(Hf).
\end{equation*}
In fact, these properties characterise the Hilbert transform among all bounded linear operators on $L^2(\R)$ (and in fact on $L^p(\R)$ for all $p$), up to a scalar multiple: any operator $T \in \Lin(L^2(\R))$ satisfying these properties must satisfy $T = cH$ for some $c \in \C$.\footnote{This result appears as \cite[Exercise 5.1.11]{grafakos}; it follows relatively simply from the Fourier multiplier representation of $H$, which we will discuss later.}
This characterisation provides a heuristic way of finding representations of the Hilbert transform and its truncations: find a family of operators which `almost' represents the Hilbert transform (for us, these will be related to martingale transforms), and somehow average over translations and dilations to produce an operator with the same invariances as $H$.
The resulting operator will be equal to $cH$ for some $c \in \C$.\todo{exposition should be improved}

\section{Dyadic systems}

To establish uniform bounds on the truncated Hilbert transforms $H_{\varepsilon, E}^{X}$ when $X$ is UMD, we will need to relate them to martingale transforms.
The transforms we will need are related to the Haar multipliers we considered in Section \ref{sec:haar-decomp}.
However, we will need not only the dyadic filtration on the unit interval $[0,1)$, but more general \emph{dyadic systems} on $\R$.

\begin{defn}
  For all $j \in \Z$ let
  \begin{equation*}
    \mc{D}_{j}^{0} = \{t2^{-j}[k, k+1) : k \in \Z\}
  \end{equation*}
  denote the set of all dyadic intervals in $\R$ of length $2^{-j}$, and let
  \begin{equation*}
    \mc{D}^{0} := \bigcup_{j \in \Z} \mc{D}_{j}^{0}
  \end{equation*}
  denote the \emph{standard dyadic system}---i.e. the set of all dyadic intervals in $\R$.
  For every two-sided (i.e. $\Z$-indexed) sequence $\omega \in \{0,1\}^{\Z}$, define for all $j \in \Z$
  \begin{equation*}
    \mc{D}_{j}^{\omega} := \mc{D}_{j}^{0} + \sum_{i > j} 2^{-i} \omega_{i}:
  \end{equation*}
  this is the set of all dyadic intervals of length $2^{-j}$ as before, but with left endpoints shifted by the number $\sum_{i > j} 2^{-i} \omega_{i} \in [0,2^{-j})$: this number has the binary representation
  \begin{equation*}
    2^{-j}(0.\omega_{j+1}\omega_{j+2}\ldots)_{2} .
  \end{equation*}
  Finally, define the \emph{$\omega$-shifted dyadic system}
  \begin{equation*}
   \mc{D}^{\omega} := \bigcup_{j \in \Z} \mc{D}_{j}^{\omega}.
  \end{equation*}
\end{defn}

We call $\mc{D}^{\omega}$ a `dyadic system' because it satisfies the following property.\footnote{This is technically the \emph{definition} of a dyadic system of intervals in $\R$. \cite[Lemma 5.1.7]{HNVW16} then says that every such dyadic system is given by $\mc{D}^\omega$ for some $\omega$. More general notions of dyadic systems (not necessarily of intervals, not necessarily in $\R$) exist. A good reference on this topic is \cite{LN18}.}

\begin{prop}\label{prop:dyadicsystems}
  Suppose $\omega \in \{0,1\}^{\Z}$ and $j \in \Z$.
  Then every interval $I \in \mc{D}_{j}^{\omega}$ has length $2^{-j}$, and there exist intervals $I_{-}, I_{+} \in \mc{D}^{\omega}_{j+1}$ such that $I = I_{-} \cup I_{+}$.
\end{prop}

\begin{proof}
  By construction every interval $I \in \mc{D}_{j}^{\omega}$ has length $2^{-j}$.
  We have
  \begin{equation*}
    I = 2^{-j}[k,k+1) + \sum_{i > j} 2^{-i} \omega_{i}
  \end{equation*}
  for some $k \in \Z$.
  Let $k' := k - \omega_{j}$, and consider the intervals
  \begin{equation*}
    \begin{aligned}
      I_{-} &= 2^{-{j+1}}[2k', 2k'+1) + \sum_{i > j-1} 2^{-i} \omega_{i}, \\
      I_{+} &= 2^{-{j+1}}[2k'+1, 2k'+2) + \sum_{i > j-1} 2^{-i} \omega_{i}. 
    \end{aligned}
  \end{equation*}
  Both of these intervals are in $\mc{D}^{\omega}_{j-1}$, both have length $2^{-(j-1)}$, and they are adjacent.
  Thus their union is an interval of length $2^{-j}$.
  The left endpoint of $I_{-}$ is
  \begin{equation*}
    \begin{aligned}
    2^{-j+1}(2k') + \sum_{i > j-1} 2^{-i} \omega_{i}
    &= 2^{-j}(k - \omega_{j}) + 2^{-j} \omega_{j} + \sum_{i > j} 2^{-i} \omega_{i} \\
    &= 2^{-j}k + \sum_{i > j} 2^{-i} \omega_{i},
  \end{aligned}
  \end{equation*}
  which equals the left endpoint of $I$.
  Similarly, the right endpoint of $I_{+}$ is equal to the right endpoint of $I$.
  Thus $I = I_{-} \cup I_{+}$.
\end{proof}

\begin{rmk}\label{rmk:dyadic-dichotomy}
The intervals in a shifted dyadic system $\mc{D}^{\omega}$ also satisfy the \emph{dyadic dichotomy}: if $I$ and $J$ are intervals in $\mc{D}^{\omega}$, then they are either comparable ($I \subseteq J$ or $J \subseteq I$) or disjoint ($I \cap J = \varnothing$).
Prove this yourself in Exercise \ref{ex:dyadic-dichotomy}.
\end{rmk}

Dyadic systems are not translation invariant: given an interval $I \in \mc{D}^{\omega}$ and a parameter $x \in \R$, it is generally not true that $I + x \in \mc{D}^{\omega}$.
However, the \emph{set of dyadic systems} is itself translation invariant.

\begin{prop}
  Let $\omega \in \{0,1\}^{\Z}$ and $x \in \R$.
  Then $\mc{D}^{\omega} + x = \mc{D}^{\omega'}$ for some $\omega' \in \{0,1\}^{\Z}$.
\end{prop}

\begin{proof}
  Suppose $I \in \mc{D}^{\omega}$, so that
  \begin{equation*}
    I = 2^{-j}[k, k+1) + \sum_{i > j} 2^{-i} \omega_{j}
  \end{equation*}
  for some $k \in \Z$.
  The parameter $x$ has a binary expansion
  \begin{equation*}
    x = \sum_{i \in \Z} 2^{-i} \eta_{i}
    = 2^{-j} \sum_{i \in \Z} 2^{j-i}\eta_{i}
    = 2^{-j} \big( \sum_{i \leq j} 2^{j-i}\eta_{i} + \sum_{i > j} 2^{j-i}\eta_{i} \Big) 
  \end{equation*}
  for some finitely supported $\eta \in \{0,1\}^{\Z}$.
  Letting $k_{j} = k + \sum_{i \leq j} 2^{j-i} \eta_{i} \in \Z$, we thus have
  \begin{equation*}
    \begin{aligned}
      I + x &= 2^{-j}[k_{j}, k_{j} + 1) + \sum_{i > j} 2^{-i} (\omega_{j} + \eta_{i}) \\
      &= 2^{-j}[k_{j}, k_{j} + 1) + \sum_{i > j} 2^{-i} \omega_{j}'
    \end{aligned}
  \end{equation*}
  where $\omega'$ is the (formal) binary expansion of the sum of the numbers with (formal) binary expansions $\omega$ and $\eta$.
  Thus $\mc{D}^{\omega} + x \subseteq \mc{D}^{\omega'}$, and a symmetric argument shows that $\mc{D}^{\omega'} \subseteq \mc{D}^{\omega} + x$.
  Therefore we have $\mc{D}^{\omega} + x = \mc{D}^{\omega'}$.
\end{proof}

We are not content with shifted dyadic systems: we also need dilations.

\begin{defn}
  For $\omega \in \{0,1\}^{\Z}$ and $t > 0$, define the \emph{dilated dyadic system}
  \begin{equation*}
    t\mc{D}^{\omega} := \{tI : I \in \mc{D}^{\omega}\}.
  \end{equation*}
\end{defn}

Of course, if we take $t$ to be a dyadic power $t = 2^{j}$ for some $j \in \Z$, then $t\mc{D}^{\omega} = \mc{D}^{\omega'}$ where $\omega'$ is a shift of $\omega$.
Thus as long as we allow for changes in the parameter $\omega$ we only need to consider dilated dyadic systems $t\mc{D}^{\omega}$ for $t \in [1,2)$.
In the following sections we will refer to a translated shifted dyadic system $t\mc{D}^{\omega}$, for some $t \in [1,2)$ and $\omega \in \{0,1\}^{\Z}$, simply as a \emph{generalised dyadic system}, and we may suppress reference to $t$ and $\omega$ and denote it by $\mc{D}$.
Although we have not formally proven it, generalised dyadic systems satisfy the conclusion of Proposition \ref{prop:dyadicsystems} (with length $t2^{-j}$ in place of $2^{-j}$) and the dyadic dichotomy (Remark \ref{rmk:dyadic-dichotomy}).

Why do we consider generalised dyadic systems?
Consider the probability space $\Omega := [1,2) \times \{0,1\}^{\Z}$, where $[1,2)$ is equipped with a probability measure $\nu$ (not necessarily the Lebesgue measure) and each factor $\{0,1\}$ has the uniform probability measure.
Since our set of generalised dyadic systems is parametrised by $\Omega$, we are now in a position to consider a `random dyadic system', and to consider the associated `random martingale transforms'.
We are also able to take \emph{expectations} of such random martingale transforms.
By the construction of our shifted and dilated dyadic systems, these expectations will satisfy the same translation, dilation, and reflection invariances that characterise the Hilbert transform.\footnote{For reflection invariance of shifted dyadic systems see Exercise \ref{ex:dyadic-refln-invariance}.}
With a bit of work, we will be able to recover truncated Hilbert transforms as expectations of random martingale transforms, and thus deduce uniform bounds for truncated Hilbert transforms from the UMD property.

\section{Generalised Haar expansions and shift operators}

Recall from Proposition \ref{prop:haar-sqfn} that for all $\mb{f} \in L^p([0,1);X)$ with $p \in (1,\infty)$ and $X$ a UMD space, we have 
  \begin{equation*}
    \begin{aligned}
    \|\mb{f}\|_{L^p([0,1);X)}
    &\simeq_{p,X} \E \Big\| \varepsilon_{\varnothing} \langle \mb{f} \rangle_{[0,1)} +  \sum_{I \in \mc{D}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p([0,1);X)} \\
    &= \E \Big\| \tilde{\varepsilon}_{0} \langle \mb{f} \rangle_{[0,1)} + \sum_{I \in \mc{D}} \tilde{\varepsilon}_{|I|} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p([0,1);X)}
  \end{aligned}
\end{equation*}
where $\mc{D}$ is the standard dyadic system on $[0,1)$.
% Since the union of the finite Rademacher spaces $\varepsilon_{n}(X)$ is dense in $\varepsilon(X)$ (Exercise \ref{ex:on-rad-spaces}), it follows that the set of functions $\mb{f} \in L^p([0,1);X))$ with finitely many nonzero Haar coefficients is dense in $L^p([0,1);X)$.
This can be extended to general dyadic systems on $\R$.

\begin{thm}\label{thm:general-haar-decompositions}
  Let $X$ be a complex UMD Banach space, $p \in (1,\infty)$, and let $\mc{D}$ be a generalised dyadic system.
  Then for all $\mb{f} \in L^p(\R;X)$,
  \begin{equation}\label{eq:gen-haar-sqfn}
      \|\mb{f}\|_{L^p(\R;X)}
      \simeq_{p,X} \E \Big\| \sum_{I \in \mc{D}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} 
      = \E \Big\| \sum_{I \in \mc{D}} \tilde{\varepsilon}_{|I|} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}.
    \end{equation}
    Furthermore, the set of functions $\mb{f} \in L^p(\R;X)$ such that the sequence $(\langle \mb{f}, h_{I} \rangle)_{I \in \mc{D}}$ is finitely supported is dense in $L^p(\R;X)$.
\end{thm}

\begin{rmk}
  Previously we only defined the Haar functions $h_{I}$ for dyadic subintervals of $[0,1)$, but the same definition applies for all intervals in $\R$:
  we have
  \begin{equation*}
    h_{I} := |I|^{-1/2}(\1_{I_{-}} - \1_{I_{+}})
  \end{equation*}
  where $I_{-}$ and $I_{+}$ are the left and right halves of the interval $I$.
\end{rmk}

\begin{proof}[Proof of Theorem \ref{thm:general-haar-decompositions}]
  % As in the case of the unit interval, the density statement follows from \eqref{eq:gen-haar-sqfn} and abstract properties of Rademacher spaces.
  We will only prove the estimate
  \begin{equation*}
    \E \Big\| \sum_{I \in \mc{D}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \lesssim_{p,X}     \|\mb{f}\|_{L^p(\R;X)},
  \end{equation*}
  as the remaining estimates can be deduced similarly (Exercise \ref{ex:mgale-reduction}).
  % rewrite if unconditionality is still needed
  By density, it suffices to prove the result for compactly supported $\mb{f}$.
  Under this assumption, there exists a scale $j_{0} \in \Z$ such that the support of $\mb{f}$ is covered by the union of two adjacent intervals $I_{j}^{0}, I_{j}^{1} \in \mc{D}^{\omega}_{j}$ for all $j \geq j_{0}$.\footnote{The union of these intervals need not be an element of $\mc{D}^{\omega}_{j-1}$: consider for example the standard dyadic system and the function $\1_{[-1/4,1/4)}$.
    The support of this function is covered by the standard dyadic intervals $[-1/2,0)$ and $[0,1/2)$, but $[-1/2,1/2)$ is not a standard dyadic interval.}
  Let $I_{j} := I_{j}^{0} \cup I_{j}^{1}$ be the union of these two intervals.
  Then for all $j \geq j_{0}$ we can write
  \begin{equation*}
    \begin{aligned}
      \E \Big\| \sum_{I \in \mc{D}^{\omega}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
      &\leq \E \Big\| \sum_{k \geq j} \sum_{\substack{I \in \mc{D}_{k}^{\omega} \\ I \subseteq I_{j}}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \\
      &+ \E \Big\| \sum_{k < j} \sum_{\substack{I \in \mc{D}_{k}^{\omega} \\ I \supset I_{j}}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)},
    \end{aligned}
  \end{equation*}
  exploiting the dyadic dichotomy to restrict to intervals $I \supset I_{j}$ in the second term.
  This term can be estimated by
  \begin{equation*}
    \begin{aligned}
      \E \Big\| \sum_{k < j} \sum_{\substack{I \in \mc{D}_{k}^{\omega} \\ I \supset I_{j}}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
      &\leq \sum_{k < j} \sum_{\sigma = 0,1} \big\| h_{I^{\sigma}_{k}} \otimes \langle \mb{f}, h_{I^{\sigma}_{j}} \rangle \big\|_{L^p(\R;X)} \\
      &\leq \sum_{k < j} \sum_{\sigma = 0,1} \|h_{I^{\sigma}_{k}}\|_{p} \| \langle \mb{f}, h_{I^{\sigma}_{j}} \rangle \|_{X} \\
      &\leq  \sum_{k < j} \sum_{\sigma = 0,1} |I_{k}^\sigma|^{\frac{1}{p}-\frac{1}{2}} \|\mb{f}\|_{L^1(\R;X)} |I_{k}^{\sigma}|^{-\frac{1}{2}} \\
      &= 2|I_{j_{0}}|^{1/p'} \|\mb{f}\|_{L^p(\R;X)} \sum_{k < j} 2^{-k(\frac{1}{p} - 1)} \\
      &\lesssim 2 |I_{j_{0}}|^{1/p'} \|\mb{f}\|_{L^p(\R;X)} 2^{j(1 - \frac{1}{p})}
    \end{aligned}
  \end{equation*}
  using that $\mb{f}$ is supported in $I_{j_{0}}$ to estimate the $L^1$ norm.
  To control the first term, let $\P_{j}$ be the renormalised Lebesgue measure $|I_{j}|^{-1} \dd x$ on $I_{j}$.
  Then $(I_{j},\P_{j})$ is a probability space (with the Borel $\sigma$-algebra).
  Define a filtration $(\mc{F}_{n}^{j})_{n \in \N}$ on $I_{j}$ by
  \begin{equation*}
    \mc{F}_{n}^{j} := \sigma\{I \in \mc{D}^{\omega}_{j+n} : I \subset I_{j}\}.
  \end{equation*} 
  Then by the same argument we used to prove Proposition \ref{prop:haar-sqfn}---really we are just looking at a rescaled, shifted version of that result---we identify the generalised Haar decomposition with a martingale representation associated to the filtration $\mc{F}^{j}_{\bullet}$, and then invoke Burkholder's inequalities, with consequence that
  \begin{equation*}
    \begin{aligned}
      \E \Big\| \sum_{k \geq j} \sum_{\substack{I \in \mc{D}_{k}^{\omega} \\ I \subseteq I_{j}}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
      &=  |I_{j}|^{1/p} \E \Big\| \sum_{k \geq j} \sum_{\substack{I \in \mc{D}_{k}^{\omega} \\ I \subseteq I_{j}}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(I_{j}, \P_{j};X)} \\
      &\lesssim_{p,X} |I_{j}|^{1/p} \|\mb{f}\|_{L^p(I_{j},\P_{j};X)} 
      \lesssim_{p,X} \|\mb{f}\|_{L^p(\R;X)}
    \end{aligned}
  \end{equation*}
  using that $\mb{f}$ is supported in $I_{j}$.
  In the end, for all $j \leq j_{0}$ we have
  \begin{equation*}
    \E \Big\| \sum_{I \in \mc{D}^{\omega}} \varepsilon_{I} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
    \lesssim_{p,X}  \|\mb{f}\|_{L^p(\R;X)} \Big(|I_{j_{0}}|^{1/p'}  2^{j(1 - \frac{1}{p})} + 1\Big),
  \end{equation*}
  so taking $j \downarrow -\infty$ completes the proof.
\end{proof}

\begin{rmk}
  This argument could have been avoided by considering conditional expectations and martingales on general $\sigma$-finite measure spaces, indexed over $\Z$ rather than $\N$.
  The result would then follow from the `extended' UMD property defined via such martingales (which is, of course, equivalent to our UMD property).
\end{rmk}

\todo{exposition}

Notice that for every interval $I \subset \R$, the Haar function $h_{I}$ is just a translation and ($L^2$-normalised) dilation of the Haar function of the unit interval:
\begin{equation*}
  h_{I} = \Dil_{|I|} \Tr_{\ell(I)} h,
\end{equation*}
where $\ell(I) := \inf(I)$ is the left endpoint of $I$ and $h = h_{[0,1)}$.
This motivates a more general definition: given a function $\map{k}{\R}{\C}$ and an interval $I \subset \R$, define
\begin{equation*}
  k_{I} := \Dil_{|I|} \Tr_{\ell(I)} k.
\end{equation*}

\begin{defn}
  We say a function $\map{k}{\R}{\C}$ is an \emph{admissible base function} if it is a finite linear combination of Haar functions $h_{J}$ with $J \in \mc{D}_{j}$, $J \subset [0,1)$ (where $\mc{D}$ is the \emph{standard} dyadic system) for some fixed $j \in \N$, and if furthermore $\|k\|_{\infty} \leq 1$.
\end{defn}

\todo{exposition}

\begin{defn}
  Let $\mc{D} = t\mc{D}^{\omega}$ be a generalised dyadic system, $X$ a Banach space, and $k$ an admissible base function.
  For $m,n \in \Z$ with $m \leq n$ we define the \emph{truncated shift operator} $S_{k,n,m} = S_{k,n,m}^{t,\omega}$ by
  \begin{equation*}
    S_{k,n,m} \mb{f} := \sum_{I \in \mc{D}_{m,n}} k_{I} \otimes \langle \mb{f}, h_{I} \rangle \qquad \forall \map{\mb{f}}{\R}{X},
  \end{equation*}
  where we write $\mc{D}_{m,n} = \bigcup_{j = m}^{n} \mc{D}_{j}$.
\end{defn}

Note that for all $x \in \R$ the sum defining $S_{k,m,n}\mb{f}(x)$ is actually finite, as for each $j \in \Z$ there is at most one interval $I \in \mc{D}_{j}$ for which $k_{I}(x) \neq 0$, since $k_{I}$ is supported in $I$.

\begin{rmk}
  In \cite{HNVW16} non-truncated shift operators $S_{k}$ are considered.
  We work with truncated shifts in order to avoid convergence issues; this is possible since ultimately we are only working with truncated Hilbert transforms.
\end{rmk}

When the admissible base function $k$ is $h$ itself, $S_{h}$ acts as a Haar projection: it sends a function to its partial Haar expansion onto intervals in $\mc{D}_{j}$ with $m \leq j \leq n$.
In general, since $k$ is a finite linear combination of Haar functions localised to equal-length subintervals of $[0,1)$, $S_{k}$ takes the generalised Haar projection of $\mb{f}$ and `shifts' each entry onto multiple Haar functions at a fixed smaller scale.

\begin{thm}\label{eq:shift-boundedness}
  Let $X$ be a complex UMD space, $p \in (1,\infty)$, $\mc{D}$ a generalised dyadic system, and $k$ an admissible base function.
  Then for all $m \leq n$, $S_{k,m,n}$ extends to a bounded operator on $L^{p}(\R;X)$ uniformly in $m$ and $n$,
  with
  \begin{equation*}
    \|S_{k,m,n} \mb{f}\|_{L^p(\R;X)} \lesssim_{p,X} \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} k_{I} \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \lesssim_{p,X} \|\mb{f}\|_{L^p(\R;X)}.
  \end{equation*}
\end{thm}

\begin{proof}
  For each interval $I \in \mc{D}$, admissibility of $k$ means that we can write
  \begin{equation*}
    k_{I} = \sum_{\theta \in \Theta} \alpha_{\theta} h_{I_{\theta}},
  \end{equation*}
  where $\Theta$ is a finite indexing set, $\alpha_{\theta} \in \C$, and $I_{\theta} \in \mc{D}$ are subintervals of $I$ of length $2^{-\ell}|I|$ for some fixed $\ell \in \N$.
  Thus for $\mb{f} \in L^p(\R;X)$ we can write
  \begin{equation*}
    \begin{aligned}
      S_{k,m,n}\mb{f} = \sum_{\theta \in \Theta}  \sum_{I \in \mc{D}_{m,n}} \alpha_{\theta} h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle .
    \end{aligned}
  \end{equation*}
  For each interval $J \in \mc{D}$ we have $J = I_{\theta}$ for at most one value of $I$ and $\theta$, so by Theorem \ref{thm:general-haar-decompositions} we can estimate
  \begin{equation*}
    \begin{aligned}
      \|S_{k} \mb{f}\|_{L^p(\R;X)}
      &= \Big\| \sum_{\theta \in \Theta} \sum_{I \in \mc{D}_{m,n}} \alpha_{\theta} h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \\
      &\lesssim_{p,X} \E \Big\| \sum_{\theta \in \Theta} \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I_{\theta}|} \alpha_{\theta} h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \\
      &= \E \Big\| \sum_{\theta \in \Theta} \sum_{I \in \mc{D}_{m,n}} \varepsilon_{2^{-\ell}|I|} \alpha_{\theta} h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}.
    \end{aligned}
   \end{equation*}
   By independence of the choice of Rademacher sequence, we have
   \begin{equation*}
     \begin{aligned}
       &\E \Big\| \sum_{\theta \in \Theta} \sum_{I \in \mc{D}_{m,n}} \varepsilon_{2^{-\ell}|I|} \alpha_{\theta}  h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)} \\
       &= \E \Big\| \sum_{\theta \in \Theta} \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} \alpha_{\theta} h_{I_{\theta}} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
       = \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} k_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)},
     \end{aligned}
   \end{equation*}
   which proves our first norm estimate.

   For the second norm estimate, we first note that the assumption $\|k\|_{\infty} \leq 1$ and the fact that $k$ is supported on $[0,1)$ implies that $|k_{I}(x)| \leq |h_{I}(x)|$ for all $x \in \R$.
   Thus by Kahane--Khitchine and the contraction principle,
   \begin{equation*}
     \begin{aligned}
       \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} k_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
       &\simeq_{p} \Big( \int_{\R} \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} k_{I}(x) \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{X}^{p} \, \dd x \Big)^{1/p} \\
       &= \Big( \int_{\R} \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} \frac{k_{I}(x)}{h_{I}(x)} h_{I}(x) \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{X}^{p} \, \dd x \Big)^{1/p} \\
       &\lesssim \Big( \int_{\R} \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} h_{I}(x) \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{X}^{p} \, \dd x \Big)^{1/p} \\
       &\simeq_{p} \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} h_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
     \end{aligned}
   \end{equation*}
   with the interpretation $\frac{k_{I}(x)}{h_{I}(x)} h_{I}(x) = 0$ when $h_{I}(x) = 0$.
   Applying Theorem \ref{thm:general-haar-decompositions} once more yields
   \begin{equation*}
     \E \Big\| \sum_{I \in \mc{D}_{m,n}} \varepsilon_{|I|} k_{I} \otimes \langle \mb{f}, h_{I} \rangle \Big\|_{L^p(\R;X)}
     \lesssim_{p,X} \|\mb{f}\|_{L^p(\R;X)}.
   \end{equation*}

\end{proof}

\begin{defn}
  Fix a UMD space $X$ and $p \in (1,\infty)$.
  Let $k$ be an admissible base function and $\nu$ a probability measure on $[1,2)$.
  For $m,n \in \Z$ with $m \leq n$ we define the \emph{average truncated dyadic shift operator} $\langle S_k \rangle^{\nu} \in \Lin(L^p(\R;X))$ by
  \begin{equation}\label{eq:avg-shift}
    \langle S_{k,m,n} \rangle^{\nu}\mb{f} := \int_{[1,2)} \int_{\{0,1\}^{\Z}} S_{k,m,n}^{\omega, t}\mb{f} \, \dd \P(\omega) \, \dd \nu(t)
  \end{equation}
  as an $L^p(\R;X)$-valued Bochner integral.
\end{defn}

\begin{lem}
  For all Banach spaces $X$ and all $p \in (1,\infty)$, the $L^p(\R;X)$-valued Bochner integral \eqref{eq:avg-shift} exists.
\end{lem}

\begin{proof}
It suffices to show that the function $(\omega,t) \mapsto S_{k}^{\omega, t}\mb{f}$ is strongly measurable and bounded.
Boundedness follows from the fact that each of the truncated dyadic shifts $S_{k,m,n}^{\omega,t}$ is bounded uniformly in $(\omega,t)$ (we make no claim of uniformity in $m$ and $n$ here).
For strong measurability, note that every $I \in t\mc{D}^{\omega}$ can be expressed as
\begin{equation*}
  I = 2^{-j}t([0,1) + s + \omega^{(j)}), \qquad \omega^{j} := \sum_{i > j} 2^{j-i} \omega_{i} \in [0,1]
\end{equation*}
for $s \in \Z$, so that
\begin{equation*}
  S_{k,m,n}^{\omega, t}\mb{f} = \sum_{j = m}^{n} \sum_{s \in \Z} k_{2^{-j}t([0,1) + s + \omega^{(j)})} \otimes \langle \mb{f}, h_{2^{-j}t([0,1) + s + \omega^{(j)})} \rangle.
\end{equation*}
Thus it suffices to show that the functions
\begin{equation*}
  (\omega,t) \mapsto k_{2^{-j}t([0,1) + s + \omega^{(j)})} \otimes \langle \mb{f}, h_{2^{-j}t([0,1) + s + \omega^{(j)})} \rangle
\end{equation*}
are strongly measurable.
This follows from the fact that the functions
\begin{equation*}
  \begin{aligned}
    (\omega,t) &\mapsto \langle \mb{f}, h_{2^{-j}t([0,1) + s + \omega^{(j)})} \rangle = \int_{\R} \mb{f}(y) h_{2^{-j}t([0,1) + s + \omega^{(j)})}(y) \, \dd y \in X\\
    (\omega,t) &\mapsto k_{2^{-j}t([0,1) + s + \omega^{(j)})} = \Dil_{2^{-j}t} \Tr_{2^{-j}t(s + \omega^{(j)})} k \in L^p(\R)
\end{aligned}
\end{equation*}
are continuous in $(\omega^{(j)},t)$.
\end{proof}

\begin{prop}
  Let $X$ be a UMD space, $p \in (1,\infty)$, and let $\nu$ be a probability measure on $[1,2)$.
  Given an admissible base function $k$, let
  \begin{equation*}
    \phi^{k}(x) := \int_{\R} k(x+u)h(u) \, \dd u \qquad \forall x \in \R
  \end{equation*}
  and for all $t > 0$ let $\phi^{k}_{t}(x) := t^{-1}\phi^{k}(x/t)$ be the $L^1$-normalised dilation of $\phi^{k}$.
  Then for all $\mb{f} \in L^p(\R;X)$ and all $m \leq n$,
  \begin{equation*}
    \langle S_{k,m,n} \rangle^{\nu} \mb{f} = \int_{2^{m}}^{2^{n}} \phi_{t}^{k} \ast \mb{f} \, \dd\nu(t).
  \end{equation*}
\end{prop}

\begin{proof}
  
\end{proof}


\section{Existence and boundedness of the Hilbert transform}

\section{Fourier multipliers}

\section{The Mikhlin and Littlewood--Paley  theorems}

\section{Exercises}


\begin{exercise}\label{ex:HT-char}
  Prove Proposition \ref{prop:HT-char}, assuming the result in the scalar case.\todo{this is false as is}
\end{exercise}

\begin{exercise}\label{ex:dyadic-dichotomy}
  Prove the dyadic dichotomy for shifted dyadic systems: if $\omega \in \{0,1\}^{\Z}$ and $I,J \in \mc{D}^{\omega}$, then either $I$ and $J$ are comparable (i.e. $I \subseteq J$ or $J \subseteq I$) or disjoint ($I \cap J = \varnothing$).
\end{exercise}

\begin{exercise}\label{ex:dyadic-refln-invariance}
  Show that the set of shifted dyadic systems is reflection invariant, i.e. that $-\mc{D}^{\omega} = \mc{D}^{\omega'}$ for some $\omega' \in \{0,1\}^{\Z}$.
\end{exercise}

\begin{exercise}\label{ex:mgale-reduction}
  Complete the proof of Theorem \ref{thm:general-haar-decompositions}.
\end{exercise}




%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../main.tex"
%%% End:
